@using RLI.EntityFramework.EDM
@using RLI.Common.Managers
@{
    Dictionary<string, string> Locale = ViewBag.Locale;
    Language currentLanguage = ViewBag.CurrentLanguage;
    string language1 = currentLanguage.Language1;
    School currentTeacherSchool = ViewBag.CurrentTeacherSchool;
    Grade currentStudentGrade = null;
    var presentialSessionKey = ViewBag.presentialSessionKey;
    if (RLI.Common.Managers.UserManager.GetUserRole(ViewBag.CurrentUser.Id).Name == "Student")
    {
        currentStudentGrade = ViewBag.CurrentStudentGrade;
    }
    ViewBag.Title = Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateVirtualClass-Create"));
}

@Styles.RenderFormat("<link rel=\"preload\" href=\"{0}\" as=\"style\" onload=\"this.rel='stylesheet'\">", "~/assets/vendors/bootstrap-datetime-picker/css/bootstrap-datetimepicker.min.css")

@if (currentLanguage == null || !currentLanguage.IsRTL)
{
    @Styles.RenderFormat("<link rel=\"preload\" href=\"{0}\" as=\"style\" onload=\"this.rel='stylesheet'\">", "~/assets/vendors/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css")
}
else
{
    @Styles.RenderFormat("<link rel=\"preload\" href=\"{0}\" as=\"style\" onload=\"this.rel='stylesheet'\">", "~/assets/vendors/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.rtl.css")
}

<style>
    .page-banner {
        margin-top: 100px;
        height: fit-content;
        margin-bottom: 30px;
        background-color: #ffffff;
    }

    .page-body {
        padding: 0;
        margin-bottom: 50px;
    }

    .bootstrap-touchspin-down, .bootstrap-touchspin-up {
        height: 100%;
    }

    .m-form .m-form__heading {
        margin-bottom: 35px;
    }

    .m-portlet .m-portlet__body {
        overflow: visible;
    }

    .m-portlet__body {
        padding-right: 100px;
        padding-left: 100px;
        padding-top: 80px;
    }

    @@media(max-width: 768px) {
        .m-portlet {
            margin-top: 0px !important;
        }

        .m-portlet__body {
            padding: 2.2rem 2.2rem;
        }
    }

    .m-portlet .m-portlet__foot {
        padding-left: 0;
        padding-right: 0;
    }

    .m-form .m-form__actions {
        padding-left: 0;
        padding-right: 0;
    }

    .col-form-label {
        font-size: 1.4rem !important;
    }

    .m-portlet .m-portlet__head {
        border-bottom: none;
    }

    .modal-dialog {
        margin-top: 95px;
    }

    .tool {
        position: relative;
        display: inline-block;
    }

        /* Tooltip text */
        .tool .tooltiptext {
            visibility: hidden;
            width: 100px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 3px;
            /* Position the tooltip text */
            position: absolute;
            z-index: 1;
            bottom: -125%;
            left: 50%;
            margin-left: -60px;
            /* Fade in tooltip */
            opacity: 0;
            transition: opacity 0.3s;
        }

            /*Tooltip arrow */
            .tool .tooltiptext::after {
                content: "";
                position: absolute;
                top: -39%;
                left: 50%;
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: transparent transparent black transparent;
            }

        /* Show the tooltip text when you mouse over the tooltip container */
        .tool:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

    .wizard-step-bar-done {
        margin-top: 20px;
        background: linear-gradient( 90deg, rgba(249,120,53,1) 0%, rgba(252,152,64,1) 50%, rgba(255,188,76,1) 100%);
        height: 20px;
        border-radius: 20px;
    }

    .wizard-step-bar-current {
        margin-top: 20px;
        background: #a4a3bf;
        height: 20px;
        border-radius: 20px;
    }

    @@media(max-width: 768px) {
        .wizard-step-bar-current {
            margin-top: 10px !important;
            background: #a4a3bf !important;
            height: 10px !important;
            border-radius: 10px !important;
        }

        .wizard-step-bar {
            margin-top: 10px !important;
            background: #cccccc !important;
            height: 10px !important;
            border-radius: 10px !important;
        }
    }

    svg {
        height: 50px
    }

    .wizard-step-bar {
        margin-top: 20px;
        background: #cccccc;
        height: 20px;
        border-radius: 20px;
    }

    .m-wizard__step.m-wizard__step--current {
        border-bottom: 0px solid !important;
    }

    .m-wizard.m-wizard--5.m-wizard--success
    .m-wizard__head .m-wizard__steps
    .m-wizard__step.m-wizard__step--done
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-label {
        color: #2a224f !important;
        font-weight: bold;
    }

    .m-wizard.m-wizard--5.m-wizard--success
    .m-wizard__head .m-wizard__steps
    .m-wizard__step.m-wizard__step--done
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-seq {
        color: #2a224f !important;
        font-weight: bold;
    }

    .m-wizard.m-wizard--5.m-wizard--success
    .m-wizard__head .m-wizard__steps
    .m-wizard__step.m-wizard__step--current
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-label {
        color: #a4a3bf !important;
        font-weight: bold;
    }

    .m-wizard.m-wizard--5.m-wizard--success
    .m-wizard__head .m-wizard__steps
    .m-wizard__step.m-wizard__step--current
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-seq {
        color: #a4a3bf !important;
        font-weight: bold;
    }

    .m-wizard.m-wizard--5
    .m-wizard__head
    .m-wizard__nav
    .m-wizard__steps
    .m-wizard__step
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-label {
        color: #cccccc !important;
        font-weight: bold;
    }

    .m-wizard.m-wizard--5
    .m-wizard__head
    .m-wizard__nav
    .m-wizard__steps
    .m-wizard__step
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-seq {
        color: #cccccc !important;
        font-weight: bold;
    }

    /*should be moved to bundle*/
    .m-wizard.m-wizard--5 .m-wizard__head .m-wizard__nav .m-wizard__steps {
        margin-top: 2rem !important;
    }
        /*should be moved to bundle*/
        .m-wizard.m-wizard--5 .m-wizard__head .m-wizard__nav .m-wizard__steps .m-wizard__step {
            padding-bottom: 0px !important;
        }
    /*should be moved to bundle*/
    @@media(max-width: 768px) {
        .m-wizard.m-wizard--5 .m-wizard__head {
            margin: unset !important;
        }

            .m-wizard.m-wizard--5 .m-wizard__head .m-wizard__nav .m-wizard__steps {
                margin-top: 0rem !important;
            }

                .m-wizard.m-wizard--5 .m-wizard__head .m-wizard__nav .m-wizard__steps .m-wizard__step .m-wizard__step-info {
                    height: unset !important;
                }
    }
    /*should be moved to bundle*/
    @@media (max-width: 1024px) {
        .m-form .m-form__group {
            margin-bottom: 10px !important;
            padding-top: 0 !important;
            padding-bottom: 10px !important;
        }

        .m-wizard.m-wizard--5 .m-wizard__head .m-wizard__nav .m-wizard__steps {
            margin: 0px !important;
        }
    }

    @@media(max-width:991px) {
        .BodyParent #m_aside_left {
            display: none !important;
        }

        .sessionIcon {
            display: none;
        }
    }

    .m-wizard__steps {
        width: unset !important;
    }

    .m-portlet .m-portlet__head {
        border-bottom: none;
    }

    .m-portlet__head {
        padding-top: 0px !important;
    }

    ul {
        list-style-type: none;
    }
</style>
<!--==========================-->
<!--=         Banner         =-->
<!--==========================-->
<section class="page-banner">
    <div class="container">
        <div class="page-title-wrapper">
            <div>
                <ul class="bradcurmed">
                    <li><a href="@Url.Action("Index","Dashboard")" rel="noopener noreferrer">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateWall"))</a></li>
                    <li><a href="@Url.Action("Index","PresentialSessions")" rel="noopener noreferrer">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateVirtualClass"))</a></li>
                    <li><a href="@Url.Action("Create","PresentialSessions")" rel="noopener noreferrer">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateNewSession"))</a></li>
                </ul>
            </div>
            <div class="row m--margin-top-20-desktop">
                <div class="col-lg-1 m-auto sessionIcon">
                    @Html.Partial("~/Views/SharedSvgs/_SynchronousLearningIcon.cshtml")
                </div>
                <div class="col-lg-5 col-12 m-auto">
                    <h1 class="page-title">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateNewSession"))</h1>
                </div>
                <div class="col-lg-3  m-auto">
                </div>
                <div class="col-lg-3 col-12 m-auto">
                </div>
            </div>

        </div>
    </div>
    <!-- /.container -->
</section>
<!-- /.page-banner -->
<!--=============================-->
<!--=         Page Body         =-->
<!--=============================-->
<div class="page-body">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="head">
                    <div class="m-portlet m-portlet--mobile m--margin-top-10">
                        <div class="m-wizard m-wizard--5 m-wizard--success" id="m_wizard">
                            <div class="m-portlet__head" style="background:#f3f3ff; border-radius:25px 25px 0px 0px; display:inline-block; width:100% !important;height: fit-content;">
                                <div class="m-wizard__head m-portlet__padding-x" style="padding: 0px !important; width: 100% !important; margin: -1rem 0 0.7rem 0;">
                                    <div class="row" style="display:block">
                                        <div class="col-xl-5">
                                            <div class="m-wizard__nav" style="border-bottom: 0px !important">
                                                <div class="m-wizard__steps">
                                                    <div class="m-wizard__step m-wizard__step--current" m-wizard-target="m_wizard_form_step_1">
                                                        <div class="m-wizard__step-info">
                                                            <a href="#" class="m-wizard__step-number">
                                                                <span class="m-wizard__step-seq"></span>
                                                                <span class="m-wizard__step-label">
                                                                    @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateStep1"))
                                                                </span>
                                                            </a>
                                                            <div id="bar_1" class="wizard-step-bar-current"></div>
                                                        </div>
                                                    </div>
                                                    <div class="m-wizard__step" m-wizard-target="m_wizard_form_step_2">
                                                        <div class="m-wizard__step-info">
                                                            <a href="#" class="m-wizard__step-number">
                                                                <span class="m-wizard__step-seq"></span>
                                                                <span class="m-wizard__step-label">
                                                                    @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateStep2"))
                                                                </span>
                                                            </a>
                                                            <div id="bar_2" class="wizard-step-bar"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-7"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="m-portlet__body">
                                <div class="m-wizard__form">
                                    <div class="m-portlet__body m-portlet__body--no-padding">

                                        <!--begin: Form Wizard Step 1-->
                                        <div class="m-wizard__form-step m-wizard__form-step--current" id="m_wizard_form_step_1" data-form-id="sessionSetupForm">
                                            @Html.Partial("_PresentialSessionSetup")
                                        </div>
                                        <!--end: Form Wizard Step 1-->
                                        <!--begin: Form Wizard Step 2-->
                                        <div class="m-wizard__form-step" id="m_wizard_form_step_2" data-form-id="sessionAudienceForm">
                                            @Html.Partial("_PresentialSessionAudience", new RLI.WebApplication.Models.PresentialSessionsAudienceViewModel())
                                        </div>
                                        <!--end: Form Wizard Step 2-->
                                        <!--begin: Form Wizard Step 3-->
                                        @*<div class="m-wizard__form-step" id="m_wizard_form_step_3" data-form-id="sessionSelectedAudienceForm">
                                                @Html.Partial("_SynchronousSessionSelectAudience", new RLI.WebApplication.Models.SynchronousSessionSelectAudienceViewModel())


                                            </div>*@
                                        <!--end: Form Wizard Step 3-->
                                    </div>
                                    <div class="m-form m-form--label-align-left- m-form--state-">
                                        <!--begin: Form Actions -->
                                        <div class="m-portlet__foot m--margin-top-40-desktop" style="border-top:none !important">
                                            <div class="m-form__actions">
                                                <div class="row">
                                                    <div class="col-lg-1 col-xl-2"></div>
                                                    <div class="col-lg-6">
                                                    </div>
                                                    <div class="col-lg-5 col-xl-4">
                                                        <button type="button" class="btn m-btn--pill btn-secondary m--padding-top-15 m--padding-bottom-15 m--padding-left-20 m--padding-right-20 w-100-mobile m--margin-bottom-10-tablet-and-mobile" data-wizard-action="prev">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateBack"))</button>
                                                        <button id="submitBtn" type="button" data-wizard-action="submit" class="btn m-btn--pill m-btn m-btn--gradient-from-primary m-btn--gradient-to-info pull-right m--padding-top-15 m--padding-bottom-15 m--padding-left-20 m--padding-right-20 w-100-mobile">
                                                            <span>
                                                                @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateCreate"))
                                                            </span>
                                                        </button>

                                                        <button id="nextBtn" type="button" data-wizard-action="next" class="btn m-btn--pill m-btn m-btn--gradient-from-primary m-btn--gradient-to-info pull-right m--padding-top-15 m--padding-bottom-15 m--padding-left-20 m--padding-right-20 w-100-mobile">
                                                            <span>
                                                                @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateNext"))
                                                            </span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--end: Form Actions -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

    </div>
</div>

@using (Html.BeginForm("GetConflicTopicName", "PresentialSessions", FormMethod.Post, new { id = "GetConflicTopicName" }))
{
    @Html.AntiForgeryToken()
    @*@Html.Hidden("sessionDateTime", "")
        @Html.Hidden("meetingDuration", "")*@
}

@section Scripts {

    <!--begin::Page Vendors -->

    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/assets/files/wizard/presentialsessions-create-wizard.js")
    @Scripts.Render("~/assets/vendors/select2/dist/js/select2.full.min.js")
    @Scripts.Render("~/assets/vendors/bootstrap-datetime-picker/js/bootstrap-datetimepicker.js")
    @Scripts.Render("~/assets/vendors/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js")

    <!--end::Page Vendors -->
    <!--begin::Page Scripts -->
<script>

    $(document).ready(function () {
        console.log("presentialSessionKey:@presentialSessionKey");
        console.log("hiii");
        jQuery.extend(jQuery.validator.messages, {
            required: "This field is required testing.",
            remote: "Please fix this field.",
            email: "Please enter a valid email address.",
            url: "Please enter a valid URL.",
            date: "Please enter a valid date.",
            dateISO: "Please enter a valid date (ISO).",
            number: "Please enter a valid number.",
            digits: "Please enter only digits.",
            creditcard: "Please enter a valid credit card number.",
            equalTo: "Please enter the same value again.",
            accept: "Please enter a value with a valid extension.",
            maxlength: jQuery.validator.format("Please enter no more than {0} characters."),
            minlength: jQuery.validator.format("Please enter at least {0} characters."),
            rangelength: jQuery.validator.format("Please enter a value between {0} and {1} characters long."),
            range: jQuery.validator.format("Please enter a value between {0} and {1}."),
            max: jQuery.validator.format("Please enter a value less than or equal to {0}."),
            min: jQuery.validator.format("Please enter a value greater than or equal to {0}.")
        });
    });

    $('.RenderBody').removeClass('col-md-9');
        var successUrl = '@Url.Action("Index")';
        var AttendanceURL = '@Url.Action("Attendance")';
        var pickedSessionDate;

        var SynchronousSessionsWizardAlertSuccessTitleSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateYourSessionisReady!"))";
        var SynchronousSessionsWizardAlertSuccessTextSwal;
        function refreshSuccessMessage(date) {
            SynchronousSessionsWizardAlertSuccessTextSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateYoursessionwasupdatedandisscheduledfor"))" + moment(date).format('L') + "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateYoucancopythelinkbelow"))";
        }
        var SynchronousSessionsWizardAlertConfirmButtonSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateAlright"))";
        var SynchronousSessionsWizardAlertCopyLinkButtonSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateCopyLink"))";
        var SynchronousSessionsWizardAlertCopiedTitleSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateCopied!"))";
        var SynchronousSessionsWizardAlertCopiedTextSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateYourmMetingLinkWasCopiedToClipboard."))";
        var SynchronousSessionsWizardSubmitAlertErrorTitleSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateOpps!"))";
        var SynchronousSessionsWizardSubmitAlertErrorTextSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateWeWerentAbleToCreateYourSessionAtTheMomentPleaseTryAgainLater."))";
        var SynchronousSessionsWizardAlertErrorTitleSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateOpps!"))";
        var SynchronousSessionsWizardAlertErrorTextSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateWeWerentAbleToSetupYourSessionAtTheMomentPleaseTryAgainLater."))";
        var SynchronousSessionsWizardAlertDateTimeConflictTitleSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateWeWerentAbleToSetupYourSessionAtTheMomentPleaseTryAgainLater.CoudlntScheduleSession!"))";
        var SynchronousSessionsWizardAlertDateTimeConflictTextSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateItLooksLikeYouHaveaDateAndTimeConflictWith")) @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateTheLessonTopic"))";
    function getConflictSwal() {
        var topicName = "@TempData["sessionTopic"]";
        if (topicName == "") {
            getConflicTopicName();
        } else {
            swal(SynchronousSessionsWizardAlertDateTimeConflictTitleSwal, SynchronousSessionsWizardAlertDateTimeConflictTextSwal + " " + topicName, "info");
        }
    }
        function getConflicTopicName() {
            mApp.block($('#m_wizard'));
            $('#GetConflicTopicName').ajaxSubmit({
                beforeSubmit: function () {
                },
                success: function (data) {
                    if (data != "404") {
                        swal(SynchronousSessionsWizardAlertDateTimeConflictTitleSwal, SynchronousSessionsWizardAlertDateTimeConflictTextSwal + " " + data, "info");
                    } else {
                        swal(SynchronousSessionsWizardAlertDateTimeConflictTitleSwal, "", "info");
                    }
                    mApp.unblock($('#m_wizard'));
                },
                error: function (xhr, status, error) {
                    console.log("swal in create");
                    swal(SynchronousSessionsWizardSubmitAlertErrorTitleSwal, SynchronousSessionsWizardSubmitAlertErrorTextSwal, "error");
                    mApp.unblock($('#m_wizard'));
                    mApp.unblock($('#m_wizard'));
                }
            });
        }
        var currentLanguage = "en";
            @{
                if(language1 == "English")
                {
                    <text>currentLanguage = "en";</text>
                } else if(language1 == "French")
                {
                    <text>currentLanguage = "fr";</text>
                } else if (language1 == "Arabic")
                {
                    <text>currentLanguage = "ar";</text>
                }
            }
        var sessionDate = $("#SessionDateTime").datetimepicker({
            format: "dd MM yyyy - HH:ii P",
            showMeridian: true,
            todayHighlight: true,
            autoclose: true,
            language: currentLanguage
        });
        $('#SessionDateTime').click(function () {
            sessionDate.datetimepicker('setStartDate', new Date());
        });
        //initialize start session date every one minute.
        var myInterval = setInterval(function () {
            sessionDate.datetimepicker('setStartDate', new Date());
        }, 60000);
        /* to stop the counter
        clearInterval(myInterval); */
        $('#SessionDateTime').on('changeDate',
            function (e) {
                var submitDateFormat = '';
                if (e.date) {
                    submitDateFormat = moment(e.date).format();
                    pickedSessionDate = e.date;
                    refreshSuccessMessage(e.date);
                }
                $("#SessionDate").val(submitDateFormat);
            });

        $("#MeetingDuration").TouchSpin({ buttondown_class: "btn btn-secondary", buttonup_class: "btn btn-secondary", min: 0.5, max: 3, step: .5, decimals: 1 });

        $("#MeetingDuration").keydown(function (event) {
                return false;
            });

        var SchoolsDropDown;
        function initiateSchoolsDropDown()
        {

            SchoolsDropDown = $('#SchoolsDropDown').select2({
                ajax: {
                    url: '@Url.Action("GetSchools")',
                    dataType: 'json',
                    type: 'POST',
                    delay: 250,
                    cache: true,
                    allowClear: true,
                    data: function (params) {
                        var query = {
                            query: params.term,
                            __RequestVerificationToken: $('@Html.AntiForgeryToken()').val()
                        }

                        return query;
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                },
                placeholder: "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateWhichSchoolIsTheSessionFor?"))",
                language: {
                    searching: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateLoadingSchool..."))";
                    }
                },
                escapeMarkup: function (markup) { return markup; },
                minimumInputLength: 0,
                templateSelection: function (data) {

                    return data.text;
                }
            });
            var data = {
                id: @currentTeacherSchool.SchoolKey,
                text: '@currentTeacherSchool.SchoolName'
            };

            var newOption = new Option(data.text, data.id, false, false);
            $('#SchoolsDropDown').append(newOption).trigger('change');
            $('#SchoolKey').val(SchoolsDropDown.val());

        }
        initiateSchoolsDropDown();

        var GradesDropDown;
        function initiateGradesDropDown() {
            GradesDropDown = $('#GradesDropDown').select2({
                ajax: {
                    url: '@Url.Action("GetGrades")',
                    dataType: 'json',
                    type: 'POST',
                    delay: 250,
                    cache: true,
                    allowClear: true,
                    data: function (params) {
                        var query = {
                            query: params.term,
                            schoolKey: SchoolsDropDown.val(),
                            __RequestVerificationToken : $('@Html.AntiForgeryToken()').val()
                        }

                        return query;
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                },
                placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateWhichGradeIsAttendingYourSession?"))',
                language: {
                    searching: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateLoadingGrades..."))";
                    },
                    noResults: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateNoResults.MakeSureToSelectSchoolfirst.."))";
                    }
                },
                escapeMarkup: function (markup) { return markup; },
                minimumInputLength: 0,
                templateSelection: function (data) {

                    return data.text;
                }
            });
            @if (RLI.Common.Managers.UserManager.GetUserRole(ViewBag.CurrentUser.Id).Name == "Student" && currentStudentGrade != null) {
                   <text>
                    var data = {
                    id: @currentStudentGrade.GradeKey,
                    text: '@currentStudentGrade.Grade1'
                    };

                    var newOption = new Option(data.text, data.id, false, false);
                    $('#GradesDropDown').append(newOption).trigger('change');
                    $('#GradeKey').val(GradesDropDown.val());
                   </text>
            }

        }
        initiateGradesDropDown();

        var SubjectsDropDown;
        function initiateSubjectsDropDown() {
            SubjectsDropDown = $('#SubjectsDropDown').select2({
                ajax: {
                    url: '@Url.Action("GetSubjects")',
                    dataType: 'json',
                    type: 'POST',
                    delay: 250,
                    cache: true,
                    allowClear: true,
                    data: function (params) {
                        var query = {
                            query: params.term,
                            schoolKey: SchoolsDropDown.val(),
                            gradeKey: GradesDropDown.val(),
                            __RequestVerificationToken: $('@Html.AntiForgeryToken()').val()
                        }

                        return query;
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                },
                placeholder: "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateWhichSubjectWillYouBeDiscussing?"))",
                language: {
                    searching: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateWhichGradeLoadingSubjects..."))";
                    },
                    noResults: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateNoResults.MakeSureToSelectcorrectGradefirst.."))";
                    }
                },
                escapeMarkup: function (markup) { return markup; },
                minimumInputLength: 0,
                templateSelection: function (data) {

                    return data.text;
                }
            });
        }
    initiateSubjectsDropDown();



        var DropDownofCurricculumGrade;
    function initiateDropDownofCurricculumGrade() {
        DropDownofCurricculumGrade = $('#DropDownofCurricculumGrade').select2({
                ajax: {
                    url: '@Url.Action("GetCurricullumGrades")',
                    dataType: 'json',
                    type: 'POST',
                    delay: 250,
                    cache: true,
                    allowClear: true,
                    data: function (params) {
                        var query = {
                            query: params.term,
                            __RequestVerificationToken: $('@Html.AntiForgeryToken()').val()
                        }

                        return query;
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                },
                placeholder: "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateWhichCurricculumGradeWillYouBeDiscussing?"))",
                language: {
                    searching: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "Loading Curricculum Grade"))";
                    },
                    noResults: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateNoResults.MakeSureToSelectcorrectCurricculumGradefirst.."))";
                    }
                },
                escapeMarkup: function (markup) { return markup; },
                minimumInputLength: 0,
                templateSelection: function (data) {

                    return data.text;
                }
            });
    }
    initiateDropDownofCurricculumGrade();
    DropDownofCurricculumGrade.on('change', function (e) {
        $('#CurricculumGradeKey').val(DropDownofCurricculumGrade.val());
    });


        //... init chap(topic)...//

        var TopicDropDown;
            function initTopicSelector() {
                TopicDropDown = $("#topicDropDown").select2({
                ajax: {
                    url: '@Url.Action("LookupTopics", "PresentialSessions")',
                    dataType: 'json',
                    type: 'POST',
                    delay: 250,
                    cache: true,
                    allowClear: true,
                    multiple: false,
                    data: function (params) {

                        var grades = [];
                        grades.push(DropDownofCurricculumGrade.val());
                        var stringGrades = JSON.stringify(grades);

                        var query = {
                            query:params.term,
                            grade: stringGrades,
                            subject: SubjectsDropDown.val(),
                                __RequestVerificationToken : $('@Html.AntiForgeryToken()').val()
                        }

                        return query;
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                },
                placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateWhichChapterWillYouBeDiscussing"))',
                language: {
                    searching: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateLoadingChapter..."))";
                    },
                    noResults: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageCreateNoResultsMakeSureToSelectTheCorrectGradeAndSubjectfirst"))";
                    }
                },
                escapeMarkup: function (markup) { return markup; },
                minimumInputLength: 0,
                maximumSelectionLength: 10,
                templateSelection: function (data) {

                    return data.text;
                },
            });
            }

            initTopicSelector();
            //... end init chapter(topic)...//


    var DropDownoftopcis;
    function initiateDropDownoftopcis() {
        DropDownoftopcis = $('#DropDownoftopcis').select2({
                ajax: {
                    url: '@Url.Action("GetTopics")',
                    dataType: 'json',
                    type: 'POST',
                    delay: 250,
                    cache: true,
                    allowClear: true,
                    data: function (params) {
                        var query = {
                            query: params.term,
                            Chapter: TopicDropDown.val(),
                            __RequestVerificationToken: $('@Html.AntiForgeryToken()').val()
                        }

                        return query;
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                },
                placeholder: "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "presentialSessionsPageCreateWhichtopicWillYouBeDiscussing?"))",
                language: {
                    searching: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "presentialSessionsPageCreateWhichtopicLoadingSubjects..."))";
                    },
                    noResults: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "presentialSessionsPageCreateNoResults.MakeSureToSelectcorrecttopicfirst.."))";
                    }
                },
                escapeMarkup: function (markup) { return markup; },
                minimumInputLength: 0,
                templateSelection: function (data) {

                    return data.text;
                }
            });
        }

    initiateDropDownoftopcis();
        SchoolsDropDown.on('change', function (e) {
            $('#SchoolKey').val(SchoolsDropDown.val());
        });
        SchoolsDropDown.change(function () {
            GradesDropDown.val(null).trigger("change");

            GradesDropDown.select2('destroy');
            initiateGradesDropDown();
        });

        GradesDropDown.on('change', function (e) {
            $('#GradeKey').val(GradesDropDown.val());
        });
        GradesDropDown.change(function () {
            SubjectsDropDown.val(null).trigger("change");

            SubjectsDropDown.select2('destroy');
            initiateSubjectsDropDown();
        });

        SubjectsDropDown.on('change', function (e) {
            $('#SubjectKey').val(SubjectsDropDown.val());
        });
        SubjectsDropDown.change(function () {
            TopicDropDown.val(null).trigger("change");

            TopicDropDown.select2("destroy");
            console.log("init topic");
            initTopicSelector();
        });

        TopicDropDown.on('change', function (e) {
            $('#ChapterKey').val(TopicDropDown.val());
        });
        /////////////
        TopicDropDown.change(function () {
            DropDownoftopcis.val(null).trigger("change");

            DropDownoftopcis.select2("destroy");
            console.log("init topic");
            initiateDropDownoftopcis();
        });
    DropDownoftopcis.on('change', function (e) {
            $('#TopicKey').val(DropDownoftopcis.val());
        });
        ///////////////////////


        $("#SessionDateTime").keydown(function (event) {
            return false;
        });

        $.validator.setDefaults({
            ignore: [],
        });

    $(document).ready(function () {


    });
</script>
    <!--end::Page Scripts -->
}
