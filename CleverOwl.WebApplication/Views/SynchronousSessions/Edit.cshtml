@using RLI.EntityFramework.EDM
@using RLI.Common.Managers
@using RLI.WebApplication.Models
@{
    Dictionary<string, string> Locale = ViewBag.Locale;
    Language currentLanguage = ViewBag.CurrentLanguage;
    string language1 = currentLanguage.Language1;
    ViewBag.Title = Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditVirtualClass-Edit"));
}

@Styles.RenderFormat("<link rel=\"preload\" href=\"{0}\" as=\"style\" onload=\"this.rel='stylesheet'\">", "~/assets/vendors/bootstrap-datetime-picker/css/bootstrap-datetimepicker.min.css")

@if (currentLanguage == null || !currentLanguage.IsRTL)
{
    @Styles.RenderFormat("<link rel=\"preload\" href=\"{0}\" as=\"style\" onload=\"this.rel='stylesheet'\">", "~/assets/vendors/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css")
}
else
{
    @Styles.RenderFormat("<link rel=\"preload\" href=\"{0}\" as=\"style\" onload=\"this.rel='stylesheet'\">", "~/assets/vendors/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.rtl.css")
}

<style>
    .page-banner {
        margin-top: 100px;
        height: fit-content;
        margin-bottom: 30px;
        background-color: #ffffff;
    }

    .page-body {
        padding: 0;
        margin-bottom: 50px;
    }

    .bootstrap-touchspin-down, .bootstrap-touchspin-up {
        height: 100%;
    }

    .m-form .m-form__heading {
        margin-bottom: 35px;
    }

    .m-portlet .m-portlet__body {
        overflow: visible;
    }

    .m-portlet__body {
        padding-right: 200px;
        padding-left: 200px;
        padding-top: 80px;
    }

    @@media(max-width: 768px) {
        .m-portlet {
            margin-top: 0px !important;
        }

        .m-portlet__body {
            padding: 2.2rem 2.2rem;
        }
    }

    .m-portlet .m-portlet__foot {
        padding-left: 0;
        padding-right: 0;
    }

    .m-form .m-form__actions {
        padding-left: 0;
        padding-right: 0;
    }

    .col-form-label {
        font-size: 1.4rem !important;
    }

    .m-portlet .m-portlet__head {
        border-bottom: none;
    }

    .modal-dialog {
        margin-top: 95px;
    }

    .tool {
        position: relative;
        display: inline-block;
    }

        /* Tooltip text */
        .tool .tooltiptext {
            visibility: hidden;
            width: 100px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 3px;
            /* Position the tooltip text */
            position: absolute;
            z-index: 1;
            bottom: -125%;
            left: 50%;
            margin-left: -60px;
            /* Fade in tooltip */
            opacity: 0;
            transition: opacity 0.3s;
        }

            /*Tooltip arrow */
            .tool .tooltiptext::after {
                content: "";
                position: absolute;
                top: -39%;
                left: 50%;
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: transparent transparent black transparent;
            }

        /* Show the tooltip text when you mouse over the tooltip container */
        .tool:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

    .wizard-step-bar-done {
        margin-top: 20px;
        background: linear-gradient( 90deg, rgba(249,120,53,1) 0%, rgba(252,152,64,1) 50%, rgba(255,188,76,1) 100%);
        height: 20px;
        border-radius: 20px;
    }

    .wizard-step-bar-current {
        margin-top: 20px;
        background: #a4a3bf;
        height: 20px;
        border-radius: 20px;
    }

    @@media(max-width: 768px) {
        .wizard-step-bar-current {
            margin-top: 10px !important;
            background: #a4a3bf !important;
            height: 10px !important;
            border-radius: 10px !important;
        }

        .wizard-step-bar {
            margin-top: 10px !important;
            background: #cccccc !important;
            height: 10px !important;
            border-radius: 10px !important;
        }
    }

    svg {
        height: 50px
    }

    .wizard-step-bar {
        margin-top: 20px;
        background: #cccccc;
        height: 20px;
        border-radius: 20px;
    }

    .m-wizard__step.m-wizard__step--current {
        border-bottom: 0px solid !important;
    }

    .m-wizard.m-wizard--5.m-wizard--success
    .m-wizard__head .m-wizard__steps
    .m-wizard__step.m-wizard__step--done
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-label {
        color: #2a224f !important;
        font-weight: bold;
    }

    .m-wizard.m-wizard--5.m-wizard--success
    .m-wizard__head .m-wizard__steps
    .m-wizard__step.m-wizard__step--done
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-seq {
        color: #2a224f !important;
        font-weight: bold;
    }

    .m-wizard.m-wizard--5.m-wizard--success
    .m-wizard__head .m-wizard__steps
    .m-wizard__step.m-wizard__step--current
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-label {
        color: #a4a3bf !important;
        font-weight: bold;
    }

    .m-wizard.m-wizard--5.m-wizard--success
    .m-wizard__head .m-wizard__steps
    .m-wizard__step.m-wizard__step--current
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-seq {
        color: #a4a3bf !important;
        font-weight: bold;
    }

    .m-wizard.m-wizard--5
    .m-wizard__head
    .m-wizard__nav
    .m-wizard__steps
    .m-wizard__step
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-label {
        color: #cccccc !important;
        font-weight: bold;
    }

    .m-wizard.m-wizard--5
    .m-wizard__head
    .m-wizard__nav
    .m-wizard__steps
    .m-wizard__step
    .m-wizard__step-info
    .m-wizard__step-number
    .m-wizard__step-seq {
        color: #cccccc !important;
        font-weight: bold;
    }

    /*should be moved to bundle*/
    .m-wizard.m-wizard--5 .m-wizard__head .m-wizard__nav .m-wizard__steps {
        margin-top: 2rem !important;
    }
        /*should be moved to bundle*/
        .m-wizard.m-wizard--5 .m-wizard__head .m-wizard__nav .m-wizard__steps .m-wizard__step {
            padding-bottom: 0px !important;
        }
    /*should be moved to bundle*/
    @@media(max-width: 768px) {
        .m-wizard.m-wizard--5 .m-wizard__head {
            margin: unset !important;
        }

            .m-wizard.m-wizard--5 .m-wizard__head .m-wizard__nav .m-wizard__steps {
                margin-top: 0rem !important;
            }

                .m-wizard.m-wizard--5 .m-wizard__head .m-wizard__nav .m-wizard__steps .m-wizard__step .m-wizard__step-info {
                    height: unset !important;
                }
    }
    /*should be moved to bundle*/
    @@media (max-width: 1024px) {
        .m-form .m-form__group {
            margin-bottom: 10px !important;
            padding-top: 0 !important;
            padding-bottom: 10px !important;
        }
    }

    @@media (max-width: 1200px) {
        .m-wizard.m-wizard--5 .m-wizard__head .m-wizard__nav .m-wizard__steps {
            width: auto;
            margin: 0rem auto 0 auto !important;
        }
    }

    @@media(max-width:991px) {
        .BodyParent #m_aside_left {
            display: none !important;
        }

        .sessionIcon {
            display: none;
        }

        ul {
            list-style-type: none;
        }
    }
</style>

<!--==========================-->
<!--=         Banner         =-->
<!--==========================-->
<section class="page-banner">
    <div class="container">
        <div class="page-title-wrapper">
            <div>
                <ul class="bradcurmed">
                    <li><a href="@Url.Action("Index","Dashboard")" rel="noopener noreferrer">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditWall"))</a></li>
                    <li><a href="@Url.Action("Index","SynchronousSessions")" rel="noopener noreferrer">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditVirtualClass"))</a></li>
                    <li><a href="@Url.Action("Create","SynchronousSessions")" rel="noopener noreferrer">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditEditSession"))</a></li>
                </ul>
            </div>
            <div class="row m--margin-top-20-desktop">
                <div class="col-lg-1 m-auto sessionIcon">
                    @Html.Partial("~/Views/SharedSvgs/_SynchronousLearningIcon.cshtml")
                </div>
                <div class="col-lg-5 col-12 m-auto">
                    <h1 class="page-title">Edit Session <span>(@ViewBag.SynchronousSessionsSetupViewModel.Topic)</span></h1>
                </div>
                <div class="col-lg-3  m-auto">
                </div>
                <div class="col-lg-3 col-12 m-auto">
                </div>
            </div>

        </div>
    </div>
    <!-- /.container -->
</section>

<!-- /.page-banner -->
<!--=============================-->
<!--=         Page Body         =-->
<!--=============================-->
<div class="page-body">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="head">
                    <div class="m-portlet m-portlet--mobile m--margin-top-10">
                        <div class="m-wizard m-wizard--5 m-wizard--success" id="m_wizard">
                            <div class="m-portlet__head" style="background:#f3f3ff; border-radius:25px 25px 0px 0px; display:inline-block; width:100% !important;height: fit-content;">
                                <div class="m-wizard__head m-portlet__padding-x" style="padding:0px!important; width:100%!important;">
                                    <div class="row" style="display:block">
                                        <div class="col-xl-4 col-sm-12 col-md-12 m--padding-5-mobile m--padding-left-50-desktop">
                                            <div class="m-wizard__nav" style="border-bottom: 0px !important">
                                                <div class="m-wizard__steps">
                                                    <div class="m-wizard__step m-wizard__step--current" m-wizard-target="m_wizard_form_step_1">
                                                        <div class="m-wizard__step-info">
                                                            <a href="#" class="m-wizard__step-number">
                                                                <span class="m-wizard__step-seq"></span>
                                                                <span class="m-wizard__step-label">
                                                                    @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditStep1"))
                                                                </span>
                                                            </a>
                                                            <div id="bar_1" class="wizard-step-bar-current"></div>
                                                        </div>
                                                    </div>
                                                    <div class="m-wizard__step" m-wizard-target="m_wizard_form_step_2">
                                                        <div class="m-wizard__step-info">
                                                            <a href="#" class="m-wizard__step-number">
                                                                <span class="m-wizard__step-seq"></span>
                                                                <span class="m-wizard__step-label">
                                                                    @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditStep2"))
                                                                </span>
                                                            </a>
                                                            <div id="bar_2" class="wizard-step-bar"></div>
                                                        </div>
                                                    </div>
                                                    <div class="m-wizard__step" m-wizard-target="m_wizard_form_step_3">
                                                        <div class="m-wizard__step-info">
                                                            <a href="#" class="m-wizard__step-number">
                                                                <span class="m-wizard__step-seq"></span>
                                                                <span class="m-wizard__step-label">
                                                                    @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditStep3"))
                                                                </span>
                                                            </a>
                                                            <div id="bar_3" class="wizard-step-bar"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-8"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="m-portlet__body">
                                <div class="m-wizard__form">
                                    <div class="m-portlet__body m-portlet__body--no-padding">

                                        <!--begin: Form Wizard Step 1-->
                                        <div class="m-wizard__form-step m-wizard__form-step--current" id="m_wizard_form_step_1" data-form-id="sessionSetupForm">
                                            @Html.Partial("_SynchronousSessionEditSetup", (object)ViewBag.SynchronousSessionsSetupViewModel)
                                        </div>
                                        <!--end: Form Wizard Step 1-->
                                        <!--begin: Form Wizard Step 2-->
                                        <div class="m-wizard__form-step" id="m_wizard_form_step_2" data-form-id="sessionEditAudienceForm">
                                            @Html.Partial("_SynchronousSessionEditAudience", (object)ViewBag.SynchronousSessionsAudienceViewModel)
                                        </div>
                                        <!--end: Form Wizard Step 2-->
                                        <!--begin: Form Wizard Step 3-->
                                        <div class="m-wizard__form-step" id="m_wizard_form_step_3" data-form-id="sessionEditSelectedAudienceForm">
                                            @Html.Partial("_SynchronousSessionEditSelectAudience", (object)ViewBag.SynchronousSessionsSelectAudienceViewModel)
                                        </div>
                                        <!--end: Form Wizard Step 3-->
                                    </div>
                                    <div class="m-form m-form--label-align-left- m-form--state-">
                                        <!--begin: Form Actions -->
                                        <div class="m-portlet__foot m--margin-top-40-desktop" style="border-top:none !important">
                                            <div class="m-form__actions">
                                                <div class="row">
                                                    <div class="col-lg-1 col-xl-2"></div>
                                                    <div class="col-lg-6">
                                                    </div>
                                                    <div class="col-lg-5 col-xl-4">
                                                        <button type="button" class="btn m-btn--pill btn-secondary m--padding-top-15 m--padding-bottom-15 m--padding-left-20 m--padding-right-20 w-100-mobile m--margin-bottom-10-tablet-and-mobile" data-wizard-action="prev">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditBack"))</button>
                                                        <button id="submitBtn" type="button" data-wizard-action="submit" class="btn m-btn--pill m-btn m-btn--gradient-from-primary m-btn--gradient-to-info pull-right m--padding-top-15 m--padding-bottom-15 m--padding-left-20 m--padding-right-20 w-100-mobile">
                                                            <span>
                                                                @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditSave"))
                                                            </span>
                                                        </button>

                                                        <button id="nextBtn" type="button" data-wizard-action="next" class="btn m-btn--pill m-btn m-btn--gradient-from-primary m-btn--gradient-to-info pull-right m--padding-top-15 m--padding-bottom-15 m--padding-left-20 m--padding-right-20 w-100-mobile">
                                                            <span>
                                                                @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditNext"))
                                                            </span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--end: Form Actions -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>


@section Scripts {

    <!--begin::Page Vendors -->

    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/assets/files/wizard/synchronoussessions-create-wizard.js")
    @Scripts.Render("~/assets/vendors/select2/dist/js/select2.full.min.js")
    @Scripts.Render("~/assets/vendors/bootstrap-datetime-picker/js/bootstrap-datetimepicker.js")
    @Scripts.Render("~/assets/vendors/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js")

    <!--end::Page Vendors -->
    <!--begin::Page Scripts -->
    <script>
    $('.RenderBody').removeClass('col-md-9');
        var successUrl = '@Url.Action("Index")';
        var pickedSessionDate;

        var SynchronousSessionsWizardAlertSuccessTitleSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditYourSessionisReady!"))";
        var SynchronousSessionsWizardAlertSuccessTextSwal;
        function refreshSuccessMessage(date) {
            SynchronousSessionsWizardAlertSuccessTextSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditYoursessionwasupdatedandisscheduledfor")) " +moment(date).format('L') +". @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditYoucancopythelinkbelow"))"
        }
        var SynchronousSessionsWizardAlertConfirmButtonSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditAlright"))";
        var SynchronousSessionsWizardAlertCopyLinkButtonSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditCopyLink"))";
        var SynchronousSessionsWizardAlertCopiedTitleSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditCopied!"))";
        var SynchronousSessionsWizardAlertCopiedTextSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditYourmMetingLinkWasCopiedToClipboard"))";
        var SynchronousSessionsWizardSubmitAlertErrorTitleSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditOpps!"))";
        var SynchronousSessionsWizardSubmitAlertErrorTextSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPagEditWeWerentAbleToCreateYourSessionAtTheMomentPleaseTryAgainLater"))";
        var SynchronousSessionsWizardAlertErrorTitleSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditOpps!"))";
        var SynchronousSessionsWizardAlertErrorTextSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditWeWerentAbleToSetupYourSessionAtTheMomentPleaseTryAgainLater"))";
        var SynchronousSessionsWizardAlertDateTimeConflictTitleSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditWeWerentAbleToSetupYourSessionAtTheMomentPleaseTryAgainLater.CoudlntScheduleSession!"))";
        var SynchronousSessionsWizardAlertDateTimeConflictTextSwal = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditItLooksLikeYouHaveaDateAndTimeConflictWith"))";
        function getConflictSwal() {
            swal(SynchronousSessionsWizardAlertDateTimeConflictTitleSwal, SynchronousSessionsWizardAlertDateTimeConflictTextSwal + " @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditTheLessonTopic")) " + "@TempData["sessionTopic"]", "info");
        }
        var currentSessionDate = $("#SessionDate").val();
        var currentLanguage = "ar";
            @{
                if(language1 == "English")
                {
                    <text>currentLanguage = "en";</text>
                } else if(language1 == "French")
                {
                    <text>currentLanguage = "fr";</text>
                } else if (language1 == "Arabic")
                {
                    <text>currentLanguage = "ar";</text>
                }
            }
        var sessionDate = $("#SessionDateTime").datetimepicker({
            format: "dd MM yyyy - HH:ii P",
            showMeridian: true,
            todayHighlight: true,
            autoclose: true,
            language: currentLanguage
        });
        $('#SessionDateTime').click(function () {
            sessionDate.datetimepicker('setStartDate', new Date());
        });
        //initialize start session date every one minute.
        var myInterval = setInterval(function () {
            sessionDate.datetimepicker('setStartDate', new Date());
        }, 60000);
            /* to stop the counter
        clearInterval(myInterval); */
        /*sessionDate.datetimepicker('setDate', currentSessionDate);*/
        refreshSuccessMessage(new Date(currentSessionDate));

        $('#SessionDateTime').on('changeDate',
            function (e) {
                var submitDateFormat = '';
                if (e.date) {
                    submitDateFormat = moment(e.date).format();
                    pickedSessionDate = e.date;
                    refreshSuccessMessage(e.date);
                }
                $("#SessionDate").val(submitDateFormat);
            });

        $("#MeetingDuration").TouchSpin({ buttondown_class: "btn btn-secondary", buttonup_class: "btn btn-secondary", min: 0.5, max: 3, step: .5, decimals: 1 });

        var SchoolsDropDown;
        function initiateSchoolsDropDown()
        {
            SchoolsDropDown = $('#SchoolsDropDown').select2({
                ajax: {
                    url: '@Url.Action("GetSchools")',
                    dataType: 'json',
                    type: 'POST',
                    delay: 250,
                    cache: true,
                    allowClear: true,
                    data: function (params) {
                        var query = {
                            query: params.term,
                            __RequestVerificationToken: $('@Html.AntiForgeryToken()').val()
                        }

                        return query;
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                },
                placeholder: "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditWhichSchoolIsTheSessionFoe?"))",
                language: {
                    searching: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditLoadingSchool..."))";
                    }
                },
                escapeMarkup: function (markup) { return markup; },
                minimumInputLength: 0,
                templateSelection: function (data) {

                    return data.text;
                }
            });
        }
        initiateSchoolsDropDown();

        var GradesDropDown;
        function initiateGradesDropDown() {
            GradesDropDown = $('#GradesDropDown').select2({
                ajax: {
                    url: '@Url.Action("GetGrades")',
                    dataType: 'json',
                    type: 'POST',
                    delay: 250,
                    cache: true,
                    allowClear: true,
                    data: function (params) {
                        var query = {
                            query: params.term,
                            schoolKey: SchoolsDropDown.val(),
                            __RequestVerificationToken : $('@Html.AntiForgeryToken()').val()
                        }

                        return query;
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                },
                placeholder: "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditWhichGradeIsAttendingYourSession?"))",
                language: {
                    searching: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditLoadingGrades..."))";
                    },
                    noResults: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditNoResults.MakeSureToSelect<b>correct School</b>first.."))";
                    }
                },
                escapeMarkup: function (markup) { return markup; },
                minimumInputLength: 0,
                templateSelection: function (data) {

                    return data.text;
                }
            });
        }
        initiateGradesDropDown();

        var SubjectsDropDown;
        function initiateSubjectsDropDown() {
            SubjectsDropDown = $('#SubjectsDropDown').select2({
                ajax: {
                    url: '@Url.Action("GetSubjects")',
                    dataType: 'json',
                    type: 'POST',
                    delay: 250,
                    cache: true,
                    allowClear: true,
                    data: function (params) {
                        var query = {
                            query: params.term,
                            schoolKey: SchoolsDropDown.val(),
                            gradeKey: GradesDropDown.val(),
                            __RequestVerificationToken: $('@Html.AntiForgeryToken()').val()
                        }

                        return query;
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                },
                placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditWhichSubjectWillYouBeDiscussing?"))',
                language: {
                    searching: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditWhichGradeLoadingSubjects..."))";
                    },
                    noResults: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditNoResults.MakeSureToSelect<b>correctGrade</b>first.."))";
                    }
                },
                escapeMarkup: function (markup) { return markup; },
                minimumInputLength: 0,
                templateSelection: function (data) {

                    return data.text;
                }
            });
        }
            initiateSubjectsDropDown();
            var TopicDropDown;
            function initTopicSelector() {
                TopicDropDown = $("#topicDropDown").select2({
                ajax: {
                    url: '@Url.Action("LookupTopics", "SynchronousSessions")',
                    dataType: 'json',
                    type: 'POST',
                    delay: 250,
                    cache: true,
                    allowClear: true,
                    multiple: false,
                    data: function (params) {

                        var grades = [];
                        grades.push(GradesDropDown.val());
                        var stringGrades = JSON.stringify(grades);

                        var query = {
                            query:params.term,
                            grade: stringGrades,
                            subject: SubjectsDropDown.val(),
                                __RequestVerificationToken : $('@Html.AntiForgeryToken()').val()
                        }

                        return query;
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                },
                placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditWhichChapterWillYouBeDiscussing"))',
                language: {
                    searching: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditLoadingChapter"))";
                    },
                    noResults: function () {
                        return "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SynchronousSessionsPageEditNoResultsMakeSureToSelectTheCorrectGradeAndSubjectfirst"))";
                    }
                },
                escapeMarkup: function (markup) { return markup; },
                minimumInputLength: 0,
                maximumSelectionLength: 10,
                templateSelection: function (data) {

                    return data.text;
                },
            });
            }

            initTopicSelector();
            //... end init chapter(topic)...//

        SchoolsDropDown.on('change', function (e) {
            $('#SchoolKey').val(SchoolsDropDown.val());
        });
        SchoolsDropDown.change(function () {
            GradesDropDown.val(null).trigger("change");

            GradesDropDown.select2('destroy');
            initiateGradesDropDown();
        });

        GradesDropDown.on('change', function (e) {
            $('#GradeKey').val(GradesDropDown.val());
        });
        GradesDropDown.change(function () {
            SubjectsDropDown.val(null).trigger("change");

            SubjectsDropDown.select2('destroy');
            initiateSubjectsDropDown();
        });

        SubjectsDropDown.on('change', function (e) {
            $('#SubjectKey').val(SubjectsDropDown.val());
        });
        SubjectsDropDown.change(function () {
            TopicDropDown.val(null).trigger("change");

            TopicDropDown.select2("destroy");
            console.log("init topic");
            initTopicSelector();
        });

        TopicDropDown.on('change', function (e) {
            $('#ChapterKey').val(TopicDropDown.val());
        });


        $("#SessionDateTime").keydown(function (event) {
            return false;
        });

        $("#SessionDateTime").keydown(function (event) {
            return false;
        });

        var currentSchoolKey = $("#SchoolKey").val();
        var currentSchoolDisplayName = $("#SchoolDisplayName").val();
        var selectedSchool = new Option(currentSchoolDisplayName, currentSchoolKey, true, true);
        SchoolsDropDown.append(selectedSchool);

        var currentGradeKey = $("#GradeKey").val();
        var currentGradeDisplayName = $("#GradeDisplayName").val();
        var selectedGrade = new Option(currentGradeDisplayName, currentGradeKey, true, true);
        GradesDropDown.append(selectedGrade);

        var currentSubjectKey = $("#SubjectKey").val();
        var currentSubjectDisplayName = $("#SubjectDisplayName").val();
        var selectedSubject = new Option(currentSubjectDisplayName, currentSubjectKey, true, true);
        SubjectsDropDown.append(selectedSubject);

        $.validator.setDefaults({
            ignore: [],
        });
    </script>
    <!--end::Page Scripts -->

    @{ 
        SynchronousSessionSelectAudienceViewModel selectedStudentEnrolled = ViewBag.SynchronousSessionsSelectAudienceViewModel;
    }

    <script>
         $(document).ready(function () {


           //initiale all the function for the select audience in Edit Page
            nbStudentChecked = '@selectedStudentEnrolled.SelectedStudentsEnrolled.Count()';
            var numberOfStudents = '@selectedStudentEnrolled.StudentsEnrolled.Count()';
            $('.student').change(function () {
                if ($(this).is(":checked")) {
                    nbStudentChecked++;
                    if (nbStudentChecked == numberOfStudents) {
                        $('.all_students').prop('checked', true);
                    }
                } else {
                    nbStudentChecked--;
                    $('.all_students').prop('checked', false);
                }
            });
            $('.all_students').change(function () {
                if ($(this).is(":checked")) {
                    $('.student').prop('checked', true);
                    nbStudentChecked = numberOfStudents;
                } else {
                    $('.student').prop('checked', false);
                    nbStudentChecked = 0;
                }
            });
            if (nbStudentChecked == 0) {
                $('.all_students').click();
            }

        });
    </script>
}
