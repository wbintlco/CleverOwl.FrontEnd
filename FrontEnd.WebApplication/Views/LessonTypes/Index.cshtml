@model IEnumerable<RLI.EntityFramework.EDM.LessonType>
@using RLI.Common.Managers
@{
    ViewBag.Title = "Index";
    Dictionary<string, string> Locale = ViewBag.Locale;
}

<style>
    .m-portlet__body {
        overflow: auto !important;
        padding: 20px;
    }
</style>



<div class="m-portlet m-portlet--mobile">
    <div class="m-portlet__head">
        <div class="m-portlet__head-caption">
            <div class="m-portlet__head-title">
                <h3 class="m-portlet__head-text">
                    @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageLessonTypes"))
                </h3>
            </div>
        </div>
        <div class="m-portlet__head-tools">
            <div class="m-portlet__nav">
                <ul class="m-portlet__nav">
                    <li class="m-portlet__nav-item">
                        <a href="@Url.Action("Create", "LessonTypes")" class="m-portlet__nav-link m-portlet__nav-link--icon"><i class="la la-plus-square"><span>@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageCreate"))</span></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="m-portlet__body" style="padding:10px">
        <div class="m-portlet m-portlet--mobile">
            <div class="m-portlet__head">
                <div class="m-portlet__head-caption">
                    <div class="m-portlet__head-title">
                        <h3 class="m-portlet__head-text">
                            @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageFilter1"))
                        </h3>
                    </div>
                </div>
            </div>
            <div class="m-portlet__body" style="padding:20px">
                <div class="row">
                    <div class="col-md-3">
                        @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageLessonType"))
                        @Html.DropDownList("LessonTypesDropDown", (SelectList)ViewBag.LessonTypesDropDown, "", new { style = "width:100%", id = "LessonTypesDropDown" })
                    </div>
                    <div class="col-md-1 mt-1">
                        <span class="clearBtnHiddenBtn" style="visibility:hidden">clear</span>
                        <button class="btn btn btn-sm btn-brand m-btn m-btn--icon m-btn--pill m-btn--wide btn-danger clearFilterClassBtn" data-filter="LessonTypesDropDown">X</button>
                    </div>
                    <div class="col-md-3">
                        @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageIconHtml"))
                        <select id="IconHTMLDropDown" style="width:100%">
                            <option></option>
                        </select>
                    </div>
                    <div class="col-md-1 mt-1">
                        <span class="clearBtnHiddenBtn" style="visibility:hidden">clear</span>
                        <button class="btn btn btn-sm btn-brand m-btn m-btn--icon m-btn--pill m-btn--wide btn-danger clearFilterClassBtn" data-filter="IconHTMLDropDown">X</button>
                    </div>
                    <div class="col-1"></div>
                    <div class="col-md-1 mt-1">
                        <div style="visibility:hidden">icon</div>
                        <div style="display:flex; align-items:center; justify-content:center; min-height:40px">
                            <i id="font" class="fa-2x"></i>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-8"></div>
                    <div class="col-2">
                        <span class="clearBtnHiddenBtn" style="visibility:hidden">apply</span>
                        <button href="" class="btn m-btn--pill btn-outline-brand m-btn m-btn--outline-2x w-100" id="applyBtn">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageApply"))</button>
                    </div>
                    <div class="col-2">
                        <span class="clearBtnHiddenBtn" style="visibility:hidden">clear</span>
                        <button class="btn m-btn--pill btn-outline-danger m-btn m-btn--outline-2x w-100" id="clearBtn">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageClear"))</button>
                    </div>
                </div>

            </div>
        </div>
        <div id="lessonTypesTable">
            @Html.Partial("_LessonTypesTable")
        </div>
    </div>
    <div class="m-portlet__foot">
        <div class="row">
            <div class="col-md-3">
                <button class="btn m-btn--pill btn-outline-brand m-btn m-btn--outline-2x w-100" id="previousBtn" style="display:none;">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPagePrevious"))</button>
            </div>
            <div class="col-md-6"></div>
            <div class="col-md-3">
                <button class="btn m-btn--pill btn-outline-brand m-btn m-btn--outline-2x w-100" id="nextBtn">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonsTypePageNext"))</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {

    <!--begin::Page Vendors -->
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/assets/vendors/select2/dist/js/select2.full.min.js")
    @Scripts.Render("~/assets/vendors/custom/datatables/datatables.bundle.js")

    <script>
        var table;
        function initTable() {
            table = $('#m-table').DataTable({
                dom: `<'row'<'col-sm-12 col-md-9'><'col-sm-12 col-md-3 align-edge'>>
                    <'row'<'col-sm-12'tr>>
                    <'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7 dataTables_pager'lp>>`,
            "language": {
                "info": "@UtilitiesManager.GetFieldLabel(Locale, "DataTableShowing") _START_ @UtilitiesManager.GetFieldLabel(Locale, "DataTableTo") _END_ @UtilitiesManager.GetFieldLabel(Locale, "DataTableOf") _TOTAL_ @UtilitiesManager.GetFieldLabel(Locale, "DataTableEntries")",

            },
            "paginate": false,
            "ordering": false,
            responsive: !0,
            pagingType: "full_numbers",
            columnDefs: [{
                targets: -1,
                title: "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "CyclesPageActions"))",
                orderable: !1,
                render: function (a, e, n, t) {

                    return '\n<span class="dropdown">' +
                        '\n<a href="#" class="btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill" data-toggle="dropdown" aria-expanded="true">' +
                        '\n<i class="la la-ellipsis-h"></i>\n</a>\n<div class="dropdown-menu dropdown-menu-right">' +
                        '\n                                <a class="dropdown-item" href="@Url.Action("Delete")/' + n[0] + '"><i class="la la-trash"></i>@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageDelete"))</a>' +
                        '\n                                <a class="dropdown-item" href="@Url.Action("Edit")/?id=' + n[0] + '"><i class="la la-edit"></i> @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageEdit"))</a>' +
                        '\n                                <a class="dropdown-item" href="@Url.Action("Details")/?id=' + n[0] + '"><i class="la la-info"></i> @Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageDetails"))</a>' +
                        '\n</div>\n</span>\n'
                }
            }, {
                targets: 0,
                visible: false,
            }],
            "stateSave": true
        });

        }
    $(document).ready(function () {

            initTable();
            $('#LessonTypesDropDown').select2({
                placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageSelectLessonType"))'
            });
            $('#IconHTMLDropDown').select2({
                placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "LessonTypesPageSelectIconHtml"))',
            });
        var iconHtml = @Html.Raw(Json.Encode(ViewBag.IconHTMLDropDown));
        var html = "";
        for(var icon in iconHtml){
            html += '<option value="' + iconHtml[icon] + '">' + iconHtml[icon] + '</i></option>';
        }
        $('#IconHTMLDropDown').append(html);
        $('#IconHTMLDropDown').change(function () {
            $('#font').removeClass();
            $('#font').addClass('fa-2x ' + $(this).val());
        });
        $('#applyBtn').on('click', function () {
            console.log("val:");
            console.log(null);
                mApp.block($("#lessonTypesTable"));
                $.ajax({
                url: '@Url.Action("GetNextOrPreviousLessonTypes", "LessonTypes")',
                type: 'POST',
                dataType: 'html',
                data: {
                    skip: 0, lessonTypeKey: $('#LessonTypesDropDown').val(), iconHtml: $('#IconHTMLDropDown').val(),
                    __RequestVerificationToken: $('@Html.AntiForgeryToken()').val()

                },
                    success: function (data) {


                    if (data.includes("Empty")) {
                        $("#lessonTypesTable").empty();
                        $("#lessonTypesTable").html("@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "_NoResultFound"))");
                        $('#nextBtn').hide();
                        $('#previousBtn').hide();
                    } else {
                        table.destroy();
                        $("#lessonTypesTable").empty();
                        $("#lessonTypesTable").html(data);
                        $('#nextBtn').show();
                        initTable();
                    }
                        mApp.unblock($("#lessonTypesTable"));
                }
            });
            });

         var paginationIndexing = 0;
            $("#nextBtn").click(function () {
                var lessonType = $("#LessonTypesDropDown option:selected").val();

                paginationIndexing++;
                mApp.block($("#lessonTypesTable"));

                $.ajax({
                    url: '@Url.Action("GetNextOrPreviousLessonTypes", "LessonTypes")',
                    type: 'POST',
                    dataType: 'html',
                    data: {
                        skip: paginationIndexing, lessonTypeKey: lessonType, iconHtml: $('#IconHtmlDropDown').val(),
                        __RequestVerificationToken: $('@Html.AntiForgeryToken()').val()

                    },
                    success: function (data) {
                        if (data.includes("Empty")) {
                            paginationIndexing--;
                            $("#nextBtn").hide();
                            $("#previousBtn").show();
                        } else {
                            $("#lessonTypesTable").empty();
                            $("#lessonTypesTable").html(data);
                            initTable();

                        }
                        if (paginationIndexing == 0) {
                            $("#previousBtn").hide();
                        } else {
                            $("#previousBtn").show();
                        }

                        mApp.unblock($("#lessonTypesTable"));
                    }
                });
            });

        $("#previousBtn").click(function () {
            var lessonTypeKey = $("#LessonTypesDropDown option:selected").val();
            $("#nextBtn").show();
            paginationIndexing= parseInt(--paginationIndexing,10);
            mApp.block($("#lessonTypesTable"));

                $.ajax({
                url: '@Url.Action("GetNextOrPreviousLessonTypes", "LessonTypes")',
                type: 'POST',
                dataType: 'html',
                data: {
                    skip: paginationIndexing, lessonTypeKey: lessonTypeKey, iconHtml: $('#IconHtmlDropDown').val(),
                    __RequestVerificationToken: $('@Html.AntiForgeryToken()').val()

                },
                success: function (data) {
                    $("#lessonTypesTable").empty();
                    $("#lessonTypesTable").html(data);
                    if (paginationIndexing == 0) {
                $("#previousBtn").hide();
            } else {
                  $("#previousBtn").show();
            }
                    initTable();

                    mApp.unblock($("#lessonTypesTable"));
                }
            });


        });

            $("#clearBtn").click(function () {
                $("#LessonTypesDropDown").val('').trigger('change');
                $("#IconHTMLDropDown").val('').trigger('change');
            });

            $('.clearFilterClassBtn').click(function () {
                var id = $(this).attr('data-filter');
                $('#' + id).val('').trigger('change');
            });
    });

    </script>




}



