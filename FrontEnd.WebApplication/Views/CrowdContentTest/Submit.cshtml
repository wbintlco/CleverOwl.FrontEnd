
@model FrontEnd.WebApplication.Models.CrowdContentViewModel
@using RLI.Common.Managers
@using RLI.WebApplication.Models
@using RLI.EntityFramework.EDM
@using RLI.Common.Enums

@{
    Dictionary<string, string> Locale = ViewBag.Locale;

    ViewBag.Title = UtilitiesManager.GetFieldLabel(Locale, "CrowdContentSubmitPageTitleViewBag");

    AspNetUser currentUser = ViewBag.CurrentUser;

    Language currentLanguage = ViewBag.CurrentLanguage;
}

@if (currentLanguage.IsRTL)
{
    <style>
        .flip {
            -webkit-transform: scaleX(-1);
            transform: scaleX(-1);
        }
    </style>
}

<style>
    .wizard-step-title-custom {
        font-size: 20px !important;
    }

    

    
</style>
@using (Html.BeginForm("GetChaptersPerChapterType", "Lessons", FormMethod.Post, new { id = "GetChaptersPerChapterTypeHidden", @class = "", @style = "display:none;" }))
{
    @Html.AntiForgeryToken()
    @Html.Hidden("chapterType", "")
    @Html.Hidden("subject", "")
    @Html.Hidden("grade", "")
}
@using (Html.BeginForm("GetTopicsPerChapterWithoutPdf", "Lessons", FormMethod.Post, new { id = "GetTopicsPerChapterHidden", @class = "", @style = "display:none;" }))
{
    @Html.AntiForgeryToken()
    @Html.Hidden("chapter", "")
}
@using (Html.BeginForm("SaveContent", "CrowdContentTest", FormMethod.Post, new { @class = "m-form m-form--fit m-form--label-align-right m-form--group-seperator-dashed", @id = "contentSaveForm", role = "form" }))
{
    @Html.AntiForgeryToken()
    @Html.EditorFor(model => model.Grade, new { htmlAttributes = new { @class = "form-control", style = "display:none", @id = "gradeKey" } })
    @Html.EditorFor(model => model.Subject, new { htmlAttributes = new { @class = "form-control", style = "display:none", @id = "subjectKey" } })
    @Html.EditorFor(model => model.Topic, new { htmlAttributes = new { @class = "form-control", style = "display:none", @id = "topic" } })
    @Html.EditorFor(model => model.LessonName, new { htmlAttributes = new { @class = "form-control", style = "display:none", @id = "lessonName" } })
    @Html.EditorFor(model => model.LessonType, new { htmlAttributes = new { @class = "form-control", style = "display:none", @id = "lessonType" } })
    @Html.EditorFor(model => model.Provider, new { htmlAttributes = new { @class = "form-control", style = "display:none", @id = "provider" } })
    @Html.EditorFor(model => model.Chapter, new { htmlAttributes = new { @class = "form-control", style = "display:none", @id = "chapterKey" } })
    @Html.EditorFor(model => model.Remark, new { htmlAttributes = new { @class = "form-control", style = "display:none", @id = "remark" } })
    @Html.EditorFor(model => model.FileType, new { htmlAttributes = new { @class = "form-control", style = "display:none", @id = "fileType" } })
    @Html.EditorFor(model => model.Library, new { htmlAttributes = new { @class = "form-control", style = "display:none", @id = "library" } })
}
<!--Begin::Main Portlet-->
<div class="m-portlet m-portlet--full-height" style="overflow:hidden;">
    <!--begin: Portlet Body-->
    <div class="m-portlet__body m-portlet__body--no-padding">

        <!--begin: Form Wizard-->
        <div class="m-wizard m-wizard--3 m-wizard--success" id="m_wizard">

            <!--begin: Message container -->
            <div class="m-portlet__padding-x">

                <!-- Here you can put a message or alert -->
            </div>

            <!--end: Message container -->
            <div class="row m-row--no-padding">
                <div class="col-xl-1 col-lg-12"></div>
                <div class="col-xl-4 col-lg-12">

                    <!--begin: Form Wizard Head -->
                    <div class="m-wizard__head">

                        <!--begin: Form Wizard Progress -->
                        <div class="m-wizard__progress">
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>

                        <!--end: Form Wizard Progress -->
                        <!--begin: Form Wizard Nav -->
                        <div class="m-wizard__nav">
                            <div class="m-wizard__steps">
                                <div class="m-wizard__step m-wizard__step--current" m-wizard-target="m_wizard_form_step_1">
                                    <div class="m-wizard__step-info">
                                        <a id="wizar-num1" href="#" class="m-wizard__step-number" style="pointer-events: none;">
                                            <span><span style="color:white; font-size:large">1</span></span>
                                        </a>
                                        <div class="m-wizard__step-label">
                                            <h3 class="m-auto m--padding-left-15 font-weight-bold wizard-step-title-custom">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageReview"))</h3>
                                            <div class="m-auto m--padding-left-15">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageGoCRDP"))</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="m-wizard__step" m-wizard-target="m_wizard_form_step_2" disabled="disabled">
                                    <div class="m-wizard__step-info">
                                        <a id="wizar-num2" href="#" class="m-wizard__step-number" style="pointer-events: none;">
                                            <span><span style="color:white; font-size:large">2</span></span>
                                        </a>
                                        <div class="m-wizard__step-label">
                                            <h3 class="m-auto m--padding-left-15 font-weight-bold wizard-step-title-custom">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageCurriculumMapping"))</h3>
                                            <div class="m-auto m--padding-left-15">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageMapConten"))</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="m-wizard__step" m-wizard-target="m_wizard_form_step_3" disabled="disabled">
                                    <div class="m-wizard__step-info">
                                        <a id="wizard-num3" href="#" class="m-wizard__step-number" style="pointer-events: none;">
                                            <span><span style="color:white; font-size:large">3</span></span>
                                        </a>
                                        <div class="m-wizard__step-label">
                                            <h3 class="m-auto m--padding-left-15 font-weight-bold wizard-step-title-custom">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageUpload"))</h3>
                                            <div class="m-auto m--padding-left-15">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageSendContentToCRDP"))</div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    @*<img class="img-fluid m--margin-left-25 m--hidden-mobile m--hidden-tablet" src="@Url.Content("~/assets/files/media/img/others/crowdcontent-wizard@2x.png")" alt="Crowd Content">*@
                                </div>
                            </div>
                        </div>

                        <!--end: Form Wizard Nav -->
                    </div>

                    <!--end: Form Wizard Head -->
                </div>
                <div class="col-xl-7 col-lg-12" style="background-color: rgb(253,248,248);">

                    <!--begin: Form Wizard Form-->
                    <div class="m-wizard__form m--padding-5-tablet-and-mobile">

                        <!--
                            1) Use m-form--label-align-left class to alight the form input lables to the right
                            2) Use m-form--state class to highlight input control borders on form validation
                        -->
                        <div class="m-portlet__body m-portlet__body--no-padding">

                            <!--begin: Form Wizard Step 1-->
                            <div class="m-wizard__form-step m-wizard__form-step--current" id="m_wizard_form_step_1" data-form-id="contentSpecificationsForm">
                                @Html.Partial("ContentSubmission/_ContentSpecifications")
                            </div>

                            <!--end: Form Wizard Step 1-->
                            <!--begin: Form Wizard Step 2-->
                            <div class="m-wizard__form-step" id="m_wizard_form_step_2" data-form-id="curriculumMappingForm">
                                @Html.Partial("ContentSubmission/_ContentCurriculumMapping")
                            </div>

                            <!--end: Form Wizard Step 2-->
                            <!--begin: Form Wizard Step 3-->
                            <div class="m-wizard__form-step" id="m_wizard_form_step_3" data-form-id="contentUploadForm">
                                @Html.Partial("ContentSubmission/_ContentUpload")
                            </div>

                            <!--end: Form Wizard Step 3-->
                        </div>

                        <div class="m-form m-form--label-align-left- m-form--state-">
                            <!--begin: Form Actions -->
                            <div class="m-portlet__foot m-portlet__foot--fit m--margin-top-40">
                                <div class="m-form__actions">
                                    <div class="row">
                                        <div class="col-lg-6 m--align-left">

                                            <a id="cancelBtn" href="#" class="btn m-btn--pill btn-metal btn-lg m-btn m-btn--custom m-btn--icon" style="display:none">
                                                <span>
                                                    <i class="far fa-window-close"></i>&nbsp;&nbsp;
                                                    <span>@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageCancel"))</span>
                                                </span>
                                            </a>
                                            @*<a href="#" class="btn btn-secondary m-btn m-btn--custom m-btn--icon" data-wizard-action="prev">
                                                    <span>
                                                        <i class="la la-arrow-left"></i>&nbsp;&nbsp;
                                                        <span>Back</span>
                                                    </span>
                                                </a>*@
                                        </div>
                                        <div class="col-lg-6 m--align-right">
                                            <a id="submitBtn" href="#" class="btn m-btn--pill btn-success btn-lg m-btn m-btn--custom m-btn--icon" data-wizard-action="submit">
                                                <span>
                                                    <i class="la la-check"></i>&nbsp;&nbsp;
                                                    <span>@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageSubmit"))</span>
                                                </span>
                                            </a>
                                            @*<a href="#" class="btn m-btn--pill btn-success btn-lg m-btn m-btn--custom m-btn--icon" data-wizard-action="next">*@
                                            <a id="cntBtn" href="#" class="btn m-btn--pill btn-success btn-lg m-btn m-btn--custom m-btn--icon" data-wizard-action="next">
                                                <span>
                                                    <span id="btnNextContent">@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageContinue"))</span>&nbsp;&nbsp;
                                                    <i class="la la-arrow-right flip"></i>
                                                </span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--end: Form Actions -->
                        </div>
                    </div>

                    <!--end: Form Wizard Form-->
                </div>
            </div>
        </div>

        <!--end: Form Wizard-->
    </div>

    <!--end: Portlet Body-->
</div>

<!--End::Main Portlet-->


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/assets/files/wizard/crowdcontent-submit-wizard.js")
    @Scripts.Render("~/assets/vendors/select2/dist/js/select2.full.min.js")
    @Scripts.Render("~/assets/vendors/intl-tel-input/build/js/intlTelInput.min.js")
    @Scripts.Render("~/assets/vendors/jquery.repeater/jquery.repeater.min.js")
    @Scripts.Render("~/assets/vendors/dropzone/dist/min/dropzone.min.js")

<script>
        var noAckknolegmentFound = "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageNoAckknolegmentFound"))";
        var participationLastStep = 0;
        var successUrl = '@Url.Action("Index","Home")';


        $(document).ready(function () {
            $(window).keydown(function (event) {
                if (event.keyCode == 13) {
                    event.preventDefault();

                    return false;
                }
            });

                $('#GradeDropDown').select2({
                    placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageSelectGrade"))'
                });
                $('#SubjectDropDown').select2({
                    placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageSelectSubject"))'
                });
                $('#LessonTypeDropDown').select2({
                    placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageSelectLesson"))'
                });
                $('#TopicDropDown').select2({
                    placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageSelectTopic"))'
                });
                $('#ChapterDropDown').select2({
                    placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageSelectChapter"))'
                });
                $('#ProviderDropDown').select2({
                    placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageSelectProvider"))'
                });
                $('#FileTypeDropDown').select2({
                    placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageSelectFileType"))'
                });
                $('#LibraryDropDown').select2({
                placeholder: '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageSelectLibrary"))'
            });
            $("#LibraryDropDown").change(function () {
                var gradeKey = $("#GradeDropDown option:selected").val();
                var subjectKey = $("#SubjectDropDown option:selected").val();
                var chapterTypeKey = $(this).val();
                if (gradeKey != '' && subjectKey != '' && chapterTypeKey != '') {
                    GetChaptersPerChapterType(gradeKey, subjectKey, chapterTypeKey);
                }

            })
            $("#GradeDropDown").change(function () {
                var chapterTypeKey = $("#LibraryDropDown option:selected").val();
                var subjectKey = $("#SubjectDropDown option:selected").val();
                var gradeKey = $(this).val();
                if (gradeKey != '' && subjectKey != '' && chapterTypeKey != '') {
                    GetChaptersPerChapterType(gradeKey, subjectKey, chapterTypeKey);
                }

            })
            $("#SubjectDropDown").change(function () {
                var chapterTypeKey = $("#LibraryDropDown option:selected").val();
                var gradeKey = $("#GradeDropDown option:selected").val();
                var subjectKey = $(this).val();
                if (gradeKey != '' && subjectKey != '' && chapterTypeKey != '') {
                    GetChaptersPerChapterType(gradeKey, subjectKey, chapterTypeKey);
                }

            })

            function GetChaptersPerChapterType(gradeKey, subjectKey, chapterTypeKey) {
                mApp.block($('#m_wizard'));
                $("#chapterType").val(chapterTypeKey);
                $("#subject").val(subjectKey);
                $("#grade").val(gradeKey);
                $("#GetChaptersPerChapterTypeHidden").ajaxSubmit({
                    beforeSubmit: function () {
                    },
                    success: function (data) {
                        mApp.unblock($('#m_wizard'));
                        $("#ChapterDropDown").empty();
                        var html = '<option></option>';
                        $.each(data, function (index, value) {
                            html += '<option value=' + value.id + '>' + value.text + '</option>'
                        });
                        $("#ChapterDropDown").append(html);
                        $("#ChapterDropDown").prepend('<option></option>');
                    },
                    error: function (xhr, status, error) {
                        mApp.unblock($('#m_wizard'));
                        console.log("Error In GetChaptersPerChapterType !!!!!!!");
                    }
                });
            }
            $(document).on("change", "#ChapterDropDown", function () {
                mApp.block($('#m_wizard'));
                var chapterKey = $(this).val();
                $("#chapter").val(chapterKey);
                $("#GetTopicsPerChapterHidden").ajaxSubmit({
                    beforeSubmit: function () {
                    },
                    success: function (data) {
                        $("#TopicDropDown").empty();
                        var html = '<option></option>';
                        $.each(data, function (index, value) {
                            html += '<option value=' + value.id + '>' + value.text + '</option>'
                        });
                        $("#TopicDropDown").append(html);
                        mApp.unblock($('#m_wizard'));
                    },
                    error: function (xhr, status, error) {
                        console.log("Error In GetTopicsPerChapter !!!!!!!");
                        mApp.unblock($('#m_wizard'));
                    }
                });
            });
            $('#cancelBtn').on('click', function () {
                mApp.block($('#m_wizard'));
                location.reload(true);
            });

            $('#submitBtn').on('click', function () {
                submit();
            });
        });




        var fileGeted;
        var UploadDropZone = new Dropzone('#pageImageDropZone', {
            url: '@Url.Action("UploadFile")',
            file: "file",
            maxFiles: 1,
            maxfilesexceeded: function (file) {
                this.removeFile(file);
            },
            maxFilesize: 500, // MB
            addRemoveLinks: true,
            sending: function () {
                mApp.block($('#m_wizard'));
                mApp.progress($('#cntBtn'));
            },
            success: function (file, response) {
                fileGeted = file;
                mApp.unblock($('#m_wizard'));
                mApp.unprogress($('#cntBtn'));
            },
            error: function (file, error) {
                mApp.unblock($('#m_wizard'));
                mApp.unprogress($('#cntBtn'));
                swal("@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageError"))", "@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageErrorWhileUploading"))", "error");
            },
            params: { __RequestVerificationToken : $('@Html.AntiForgeryToken()').val()}
        });


        function submit() {
            mApp.block($('#m_wizard'));
            mApp.progress($('#cntBtn'));
            console.log(fileGeted);
            $('#gradeKey').val($('#GradeDropDown').val());
            $('#subjectKey').val($('#SubjectDropDown').val());
            $('#chapterKey').val($('#ChapterDropDown').val());
            $('#lessonType').val($('#LessonTypeDropDown').val());
            $('#topic').val($('#TopicDropDown').val());
            $('#lessonName').val($('#LessonName').val());
            $('#provider').val($('#ProviderDropDown').val());
            $('#remark').val($('#Remark').val());
            $('#fileType').val($('#FileTypeDropDown').val());
            $('#library').val($('#LibraryDropDown').val());

            if ($('#FileTypeDropDown').val() == '') {
                swal('@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageEmptyField"))', '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPagePleaseSelectAType"))', "error");
                mApp.unblock($('#m_wizard'));
                mApp.unprogress($('#cntBtn'));
                return;
            }

                $('#contentSaveForm').ajaxSubmit({

                    success: function (data) {
                        if (data == "Success") {
                            mApp.unblock($('#m_wizard'));
                            mApp.unprogress($('#cntBtn'));
                            return;
                        }
                        if (data == -1) {
                            mApp.unblock($('#m_wizard'));
                            mApp.unprogress($('#cntBtn'));
                            swal('@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageEmptyFile"))', '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPagePleaseUploadAFile"))', "error");
                            return;
                        }

                    },
                    error: function (xhr, status, error) {

                        mApp.unblock($('#m_wizard'));
                        mApp.unprogress($('#cntBtn'));

                        swal('@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageError"))', '@Html.Raw(UtilitiesManager.GetFieldLabel(Locale, "SubmitPageErrorWhileSubmiting"))', "error");

                    }


                });



        }

</script>
}